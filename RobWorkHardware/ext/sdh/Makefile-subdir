#=======================================================================
#//! \file
#//! \section common_makefile_subdir_general General file information
#//!   \author    Dirk Osswald 
#//!   \date      2007-01-15
#//!  
#//! \brief  
#//!   Generic Makefile for calling other Makefiles in sub directories
#//!
#//!   This Makefile is meant to be included in other Makefiles, it
#//!   provides some generic variables and targets
#//!
#//! \section common_makefile_subdir_variables Makefile variables
#//!   - SUBDIRS : The list of subdirectories where to call make in
#//! 
#//! \section common_makefile_subdir_targets Makefile targets
#//!   Each of the following targets is made recursively in
#//!   all subdirectories SUBDIRS:
#//!   - \b \c all
#//!   - \b \c build
#//!   - \b \c doc
#//!   - \b \c tags
#//!   - \b \c clean
#//!   - \b \c mrproper
#//!   - \b \c install
#//!   - \b \c install_only
#//!   - \b \c dist
#//!   - \b \c dist_only
#//!
#//!   The Makefiles in the subdirectories decide what to do (and which
#//!   targets are valid at all).
#//!
#//! \section common_makefile_subdir_links Links
#//!   - The online documentation for \c gnu \c make can be found at
#//!     <a href="http://www.gnu.org/software/make/manual/make.html">
#//!     http://www.gnu.org/software/make/manual/make.html</a>
#//!  
#//! \section common_makefile_subdir_copyright Copyright
#//!
#//!  Copyright (c) 2007 SCHUNK GmbH & Co. KG
#//!
#//!  <HR>
#//!  \internal
#//!
#//!    \subsection common_makefile_subdir_details SVN related, detailed file specific information:
#//!      $LastChangedBy: Osswald2 $
#//!      $LastChangedDate: 2008-10-08 09:39:41 +0200 (Mi, 08 Okt 2008) $
#//!      \par SVN file revision:
#//!        $Id: Makefile-subdir 3657 2008-10-08 07:39:41Z Osswald2 $
#//!
#//!  \subsection common_makefile_subdir_changelog Changelog of this file:
#//!      \include Makefile-subdir.log
#//!
#=======================================================================
#//! \cond ignore_me   doxygen cannot parse Makefiles, so just ignore it


########################################################################
# now the targets


.PHONY: all build doc tags clean mrproper install install_only dist dist_only
all build doc tags clean mrproper install install_only dist dist_only: recursive 
all:          TARGET=all
build:        TARGET=build
doc:          TARGET=doc
tags:         TARGET=tags
clean:        TARGET=clean
mrproper:     TARGET=mrproper
install:      TARGET=install
install_only: TARGET=install_only
dist:         TARGET=dist
dist_only:    TARGET=dist_only

# generate target ${TARGET} in all subdirectories in ${SUBDIRS}
#   this will stop in case the called make reports an error unless -k has been given
.PHONY: recursive
recursive:
	@for d in ${SUBDIRS} ; do \
	  echo ;\
	  echo "======================================================================" ;\
	  echo "| Generating target ${TARGET} in subdir $$d" ;\
	  echo "----------------------------------------------------------------------" ;\
	  ${MAKE} -C $$d ${TARGET} ;\
	  if [ "$$PIPESTATUS" != "0" ]; then \
	    if echo "$$MAKEFLAGS" | grep -q -e "\(^k\|^[^ ].*k\| -k\)" - ; then \
	      true ; \
	    else \
	      break ; \
	    fi ; \
	  fi ; \
	  echo "----------------------------------------------------------------------" ;\
	  echo "| Finished generating target ${TARGET} in subdir $$d" ;\
	  echo "======================================================================" ;\
	done

#
#-----------------------------------------------------------------------

#-----------------------------------------------------------------------
# emacs settings:
# Local Variables:
# mode: Makefile
# End:
#-----------------------------------------------------------------------
#//! \endcond
########################################################################
